2+2
head(df_psu_temp_vars_wide)
q()
n
q()
n
ls()
q()
n
# Load Libraries ----
pacman::p_load(tidyverse, data.table, janitor, fst, beepr, openxlsx, lme4, broom, broom.mixed, googledrive, here)
pacman::p_load(sf, sp, raster, terra, tidyterra, ncdf4, rnaturalearth)
# Load Libraries ----
rm(list = ls())
pacman::p_load(tidyverse, data.table, janitor, fst, beepr, openxlsx, lme4, broom, broom.mixed, here, tictoc)
pacman::p_load(MatchIt, cobalt, sandwich, survey, ggplot2)
# Set paths ----
source(here("paths-mac.R"))
# Read datasets ----
df_paper_final <- readRDS(here(path_project, "data", "processed-data", "1.8-final-data-for-paper-climzones.rds"))
# Data processing ----
## Create a variable for season of birth for India
df_paper_final$birth_season <- case_when(
df_paper_final$month_birth %in% c(1, 2) ~ "winter",
df_paper_final$month_birth %in% c(3, 4, 5) ~ "pre-monsoon",
df_paper_final$month_birth %in% c(6, 7, 8, 9) ~ "monsoon",
df_paper_final$month_birth %in% c(10, 11, 12) ~ "post-monsoon"
) |>
as.factor()
# Data processing ----
## Create a variable for season of birth for India
df_paper_final$birth_season <- case_when(
df_paper_final$month_birth %in% c(1, 2) ~ "winter",
df_paper_final$month_birth %in% c(3, 4, 5) ~ "pre-monsoon",
df_paper_final$month_birth %in% c(6, 7, 8, 9) ~ "monsoon",
df_paper_final$month_birth %in% c(10, 11, 12) ~ "post-monsoon"
) |>
as.factor()
## Define exposure variables ----
varlist_exposure_all <- c(
# Wet bulb temperature (absolute)
"hotday_wb_30", "hw_wb_30_2d", "hw_wb_30_3d", "hw_wb_30_5d",
"hotday_wb_31", "hw_wb_31_2d", "hw_wb_31_3d", "hw_wb_31_5d",
"hotday_wb_32", "hw_wb_32_2d", "hw_wb_32_3d", "hw_wb_32_5d",
# Wet bulb temperature (percentile)
"hotday_wb_90", "hw_wb_90_2d", "hw_wb_90_3d", "hw_wb_90_5d",
"hotday_wb_95", "hw_wb_95_2d", "hw_wb_95_3d", "hw_wb_95_5d",
"hotday_wb_97", "hw_wb_97_2d", "hw_wb_97_3d", "hw_wb_97_5d"
)
## Define covariates for direct matching ----
covariates_all <- c("mat_edu_level", "mat_age_grp_at_birth", "mat_media_exp_any",
"hh_religion_club", "hh_caste_club",
"mat_birth_order", "hh_access_issue_distance",
"hh_wealth_quintile_ru_og", "rural")
## Convert all covariates to factors
df_paper_final <- df_paper_final %>%
mutate(across(all_of(covariates_all), as.factor))
## Set exposure variable
exposure_var <- varlist_exposure_all[13]
## Create separate datasets long-term Tmax tertiles
tabyl(df_paper_final$lt_tmax_mean_cat_tert_wb)
df_paper_lt_tert1 <- df_paper_final |> filter(lt_tmax_mean_cat_tert_wb == 1)
df_paper_lt_tert2 <- df_paper_final |> filter(lt_tmax_mean_cat_tert_wb == 2)
df_paper_lt_tert3 <- df_paper_final |> filter(lt_tmax_mean_cat_tert_wb == 3)
tabyl(df_paper_final$clim_zone_short)
df_paper_arid <- df_paper_final |> filter(clim_zone_short == "semi-Arid" | clim_zone_short == "arid")
df_paper_trop_wet <- df_paper_final |> filter(clim_zone_short == "trop_wet")
df_paper_trop_wet_dry <- df_paper_final |> filter(clim_zone_short == "trop_wet_dry")
# Plot home birth rates by climatic zone and month
## Get home birth rates by clim zone and month
df_plot_clim <- df_paper_final |>
filter(clim_zone_short %in% c("semi-Arid", "trop_wet", "trop_wet_dry")) |>
group_by(clim_zone_short, month_birth_fac) |>
summarise(home_birth_rate = mean(dv_home_del), .groups = "drop")
head(df_plot)
head(df_plot_clim)
## Plot
df_plot_clim |>
ggplot(aes(x = month_birth_fac, y = home_birth_rate, color = clim_zone_short, group = clim_zone_short)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
labs(
x = "Month of Birth",
y = "Home Birth Rate",
color = "Climatic Zone"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
) +
scale_color_manual(values = c("semi-Arid" = "red", "trop_wet" = "blue", "trop_wet_dry" = "green"))
# Identify states that are in tropical wet-dry
df_paper_final |>
filter(clim_zone_short == "trop_wet_dry") |>
select(state_name) |>
distinct()
# Plot home birth rates by LT mean and month
## Get home birth rates by LT mean and month
df_plot_lt <- df_paper_final |>
group_by(lt_tmax_mean_cat_tert_wb, month_birth_fac) |>
summarise(home_birth_rate = mean(dv_home_del), .groups = "drop")
head(df_plot_lt)
## Plot
df_plot_lt |>
ggplot(aes(x = month_birth_fac, y = home_birth_rate, color = lt_tmax_mean_cat_tert_wb, group = lt_tmax_mean_cat_tert_wb)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
labs(
x = "Month of Birth",
y = "Home Birth Rate",
color = "LT Mean Tertile"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
) +
scale_color_manual(values = c("1" = "red", "2" = "blue", "3" = "green"))
# Plot home birth rates by state and month
## Get home birth rates by state and month
df_plot_state <- df_paper_final |>
group_by(state_name_fac, month_birth_fac) |>
summarise(home_birth_rate = mean(dv_home_del), .groups = "drop")
head(df_plot_state)
colnames(df_paper_final |> select(contains("mean")))
colnames(df_paper_final |> select(contains("mean")))
colnames(df_paper_final |> select(contains("wb")))
df_paper_final <- df_paper_final[
, st_mean_max_temp_wb := mean(max_temp_wb, na.rm = T), by = c("psu")]
setDT(df_paper_final)
df_paper_final <- df_paper_final[
, st_mean_max_temp_wb := mean(max_temp_wb, na.rm = T), by = c("psu")]
df_paper_final$st_tmax_wb_tert <- cut_number(df_paper_final$st_mean_max_temp_wb, 3)
tabyl(df_paper_final$st_tmax_wb_tert)
df_paper_final[, st_tmax_wb_tert := frank(st_mean_max_temp_wb, ties.method = "min") * 3 / .N]
df_paper_final[, st_tmax_wb_tert := ceiling(st_tmax_wb_tert)]
df_paper_final$st_tmax_wb_tert <- as.factor(df_psu_temp_precip_paper$lt_tmax_mean_cat_tert_wb)
df_paper_final$st_tmax_wb_tert <- as.factor(df_paper_final$st_tmax_wb_tert)
tabyl(df_paper_final$st_tmax_wb_tert)
## Get home birth rates by short term tertile and month
df_plot_st <- df_paper_final |>
group_by(st_tmax_wb_tert, month_birth_fac) |>
summarise(home_birth_rate = mean(dv_home_del), .groups = "drop")
head(df_plot_st)
## Plot
df_plot_st |>
ggplot(aes(x = month_birth_fac, y = home_birth_rate, color = st_tmax_wb_tert, group = st_tmax_wb_tert)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
labs(
x = "Month of Birth",
y = "Home Birth Rate",
color = "ST Mean Tertile"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
) +
scale_color_manual(values = c("1" = "red", "2" = "blue", "3" = "green"))
## Plot
df_plot_clim |>
ggplot(aes(x = month_birth_fac, y = home_birth_rate, color = clim_zone_short, group = clim_zone_short)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
labs(
x = "Month of Birth",
y = "Home Birth Rate",
color = "Climatic Zone"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
) +
scale_color_manual(values = c("semi-Arid" = "red", "trop_wet" = "blue", "trop_wet_dry" = "green"))
source("/Users/akdey/Desktop/codes/manuscripts/1-clim-papers/heat/heat-and-home-births-india/R/7.2-weights-by-LT-temp.R", encoding = "UTF-8")
